/**
 * @version v1.1.1
 */
!function t(n,e,i){function s(o,r){if(!e[o]){if(!n[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=e[o]={exports:{}};n[o][0].call(u.exports,function(t){var e=n[o][1][t];return s(e||t)},u,u.exports,t,n,e,i)}return e[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(t,n,e){function i(t){if(!t||!t.context)return{};this.context=t.context,this.entity=t.entity,this.style=t.style}t("../core/Util.js");i.prototype={constructor:i,position:null,style:null,draw:function(){this.context.drawImage(this.entity,this.position.x,this.position.y)},getCenterPosition:function(){var t=this.style.radius;return this.position?{x:this.position.x+t,y:this.position.y+t}:null},setPosition:function(t,n){var e=this.style.radius;this.position={x:t-e,y:n-e}}},n.exports=i},{"../core/Util.js":7}],2:[function(t,n,e){function i(t){this.maxCount=t.maxCount||200,this.splits=t.splits||0,this.setData(t.data)}var s=t("../core/geo.js");t("./Rect.js");i.prototype={constructor:i,query:function(t){return this.getPointsInBounds(t,this.indexes)},setData:function(t){Date.now();var n=this.createBoundsOfPoints(t);this.indexes=this.createGridTreeIndexes(t,n,this.splits||Math.max(~~Math.pow(t.length/this.maxCount,.5),2))},getPointsInBounds:function(t,n){var e,i=[];for(var a in n)e=n[a],s.boundsCrossBounds(t,e.bounds)&&i.push(e);return i},createTreeIndexes:function(t,n){function e(n){var o=s.isPointsCountInBoundsLessThan(t,n,a);if(0===o.status)i.push({bounds:n,shapes:o.points});else if(1===o.status)for(var r,l=s.splitBounds(n),h=0;r=l[h++];)e(r)}var i=[],s=this,a=this.maxCount;Date.now();return e(n),i},isPointsCountInBoundsLessThan:function(t,n,e){for(var i,a=[],o=0,r=0;i=t[r++];)if(s.latlngInBounds(i,n)&&(a.push(i),++o>e))return{status:1};return a.length>0?{status:0,points:a}:{status:-1}},splitBounds:function(t){var n=t.min,e=t.max,i={lat:(n.lat+e.lat)/2,lng:(n.lng+e.lng)/2};return[{min:{lat:i.lat,lng:n.lng},max:{lat:e.lat,lng:i.lng}},{min:{lat:i.lat,lng:i.lng},max:{lat:e.lat,lng:e.lng}},{min:{lat:n.lat,lng:n.lng},max:{lat:i.lat,lng:i.lng}},{min:{lat:n.lat,lng:i.lng},max:{lat:i.lat,lng:e.lng}}]},createGridTreeIndexes:function(t,n,e){Date.now();for(var i,e,s,a=this.createIndexesByBounds(t,n,e),o=this.maxCount,r=0,l=0;s=a[l++];)(r=s.shapes.length)>o&&(e=Math.max(2,~~Math.pow(r/o,.5)),(i=this.createIndexesByBounds(s.shapes,s.bounds,e)).unshift(l-1,1),Array.prototype.splice.apply(a,i));return a},createIndexesByBounds:function(t,n,e){for(var i,s=n.min,a=n.max,o={lat:(a.lat-s.lat)/e,lng:(a.lng-s.lng)/e},r={},l={},h=0;h<e;h++)for(var u=0;u<e;u++)r[u+"_"+h]={shapes:[],bounds:{min:{lat:s.lat+o.lat*h,lng:s.lng+o.lng*u},max:{lat:s.lat+o.lat*(h+1),lng:s.lng+o.lng*(u+1)}}};for(var p,d=0;p=t[d++];)(i=this.getIndexKeyOfPoints(p,n,e))in l||(l[i]=r[i]),l[i].shapes.push(p);var c=[];for(var d in l)c.push(l[d]);return r=null,l=null,c},getIndexKeyOfPoints:function(t,n,e){return Math.min(~~((t.lng-n.min.lng)/(n.max.lng-n.min.lng)*e),e-1)+"_"+Math.min(~~((t.lat-n.min.lat)/(n.max.lat-n.min.lat)*e),e-1)},createGridIndexes:function(t,n,e){Date.now();for(var i,s=n.min,a=n.max,o={lat:(a.lat-s.lat)/e,lng:(a.lng-s.lng)/e},r={},l={},h=0;h<e;h++)for(var u=0;u<e;u++)r[u+"_"+h]={shapes:[],bounds:{min:{lat:s.lat+o.lat*h,lng:s.lng+o.lng*u},max:{lat:s.lat+o.lat*(h+1),lng:s.lng+o.lng*(u+1)}}};for(var p,d=0,c=0;p=t[c++];)(i=this.getIndexKeyOfPoints(p,n,e))in l||(l[i]=r[i],d++),l[i].shapes.push(p);return r=null,l},createBoundsOfPoints:function(t){for(var n,e={lat:90,lng:180},i={lat:0,lng:0},s=(Date.now(),0);n=t[s++];)e.lng=Math.min(n.lng,e.lng),i.lng=Math.max(n.lng,i.lng),e.lat=Math.min(n.lat,e.lat),i.lat=Math.max(n.lat,i.lat);return{min:e,max:i}}},n.exports=i},{"../core/geo.js":8,"./Rect.js":3}],3:[function(t,n,e){function i(t){if(!t||!t.context)return{};this.context=t.context,this.bounds=t.bounds}t("../core/Util.js");i.prototype={constructor:i,position:null,style:null,draw:function(){var t=this.context,n=this.bounds;t.beginPath(),t.rect(n.x,n.y,n.w,n.h),t.lineWidth=2,t.strokeStyle="rgba(255, 55, 0, 1)",t.stroke()}},n.exports=i},{"../core/Util.js":7}],4:[function(t,n,e){function i(t){if(t){if(h.call(this,t),this.style=o.extend({},d,t.style),this.attributes=t.attributes||{},this.groupBy=t.groupBy||null,this.groupBy&&t.groupStyles){var n=t.groupStyles;for(var e in n)n[e]=o.extend({},d,n[e]);this.groupStyles=n}this.entityDots=s(this.style,this.groupStyles),this.onClick=t.onClick,this.maxCount=t.maxCount||100,this.splits=t.splits||0,this.debug=t.debug||!1,this.visible=!0}}function s(t,n){var e={};if(e.default=a(t),n)for(var i in n)e[i]=a(n[i]);return e}function a(t){var n=document.createElement("canvas"),e=n.getContext("2d"),i=t.radius,s=t.strokeWidth;return n.width=2*i,n.height=2*i,e.fillStyle=t.fillColor,e.arc(i,i,i-s,0,2*Math.PI),e.closePath(),e.fill(),e.strokeStyle=t.strokeColor,e.lineWidth=s,e.arc(i,i,i-s,0,2*Math.PI),e.stroke(),n}var o=t("../core/Util.js"),r=t("../core/geo.js"),l=t("./DotSpatialIndex.js"),h=t("../core/Animation.js"),u=t("./Dot.js"),p=t("./Rect.js"),d={fillColor:"rgba(220, 220, 0, 0.8)",strokeColor:"rgba(220, 0, 0, 0.8)",strokeWidth:1,radius:10};i.prototype=new h,i.prototype.construct=i,i.prototype.init=function(){var t=this.onClick;t&&qq.maps.event.addListener(this.map,"click",function(n){var e=this.getDotsInCurrentBounds();if(e&&this.visible){var i,s,a,o,r,l=1e3,h=0,u=e.length,p=n.pixel;do{(o=(a=e[h]).dot)&&(s=o.getCenterPosition())&&(i=Math.sqrt((p.x-s.x)*(p.x-s.x)+(p.y-s.y)*(p.y-s.y)))<l&&(l=i,r=a),h++}while(h<u);var d=null;if(r&&l<10){var c=this.getProjection(),g=c.fromLatLngToContainerPixel(n.latLng),m=c.fromLatLngToContainerPixel(new qq.maps.LatLng(Number(r.lat),Number(r.lng))),f=Math.sqrt((g.x-m.x)*(g.x-m.x)+(g.y-m.y)*(g.y-m.y));f<10&&(d={id:r.id,lat:r.lat,lng:r.lng})}t(d)}}.bind(this))},i.prototype.buildDataAndShapes=function(t){this.spatialIndex=new l({data:t,maxCount:this.maxCount,splits:this.splits}),this.data=t,this.createShapes(t),this.viewChangeHandler(),this.scene.render()},i.prototype.createShapes=function(t){var n,e,i,s=this.context,a=this.groupBy,o=this.entityDots,r=this.groupStyles,l=!(!o||!r),h=[];Date.now();for(var p in t)i=t[p],n=l?r[i[a]]||this.style:this.style,e=l?o[i[a]]||o.default:o.default,i.dot=new u({context:s,style:n,entity:e}),i.latlng=new qq.maps.LatLng(i.lat,i.lng),h.push(i.dot);return h},i.prototype.viewChangeHandler=function(){if(this.visible){for(var t,n,e,i,s,a=this.getIndexesInCurrentBounds(),o=this.getProjection(),l=this.qqmapBounds2LocalBounds(this.map.getBounds()),h=[],u=(Date.now(),0),p=0,d=0,c=a.length;d<c;d++){index=a[d],t=index.pixBounds=this.getPixBounds(index.bounds),e=index.shapes,n=index.bounds,e=index.shapes,u+=index.shapes.length,r.boundsInBounds(n,l)||r.getUnionBounds(n,l)&&(p+=index.shapes.length-e.length);for(var g=0,m=e.length;g<m;g++)(i=e[g]).relativePosition?s={x:t.x+t.w*i.relativePosition.x,y:t.y+t.h*i.relativePosition.y}:(s=o.fromLatLngToContainerPixel(i.latlng),i.relativePosition={x:(s.x-t.x)/t.w,y:(s.y-t.y)/t.h}),i.dot.setPosition(s.x,s.y),h.push(i.dot)}var f=[];Array.prototype.push.apply(f,h),Array.prototype.push.apply(f,this.getBoundsRects()),this.scene.setShapes(f)}else this.scene.setShapes([])},i.prototype.getBoundsRects=function(){var t,n=[];if(this.debug){t=this.spatialIndex.indexes;for(var e in t)n.push(new p({context:this.context,bounds:this.getPixBounds(t[e].bounds)}))}return n},i.prototype.getPixBounds=function(t){var n=this.getProjection(),e=t.min,i=t.max,s=new qq.maps.LatLng(i.lat,e.lng),a=new qq.maps.LatLng(e.lat,i.lng),o=n.fromLatLngToContainerPixel(s),r=n.fromLatLngToContainerPixel(a),l=o.x,h=o.y;return{x:l,y:h,w:r.x-l,h:r.y-h}},i.prototype.getIndexesInCurrentBounds=function(){if(this.spatialIndex){var t=this.qqmapBounds2LocalBounds(this.map.getBounds());return this.spatialIndex.query(t)}return[]},i.prototype.getDotsInCurrentBounds=function(){var t=[],n=this.getIndexesInCurrentBounds();for(var e in n)Array.prototype.push.apply(t,n[e].shapes);return t},i.prototype.getPointsInBounds=function(t,n){for(var e,i=[],s=0;e=t[s++];)r.latlngInBounds(e,n)&&i.push(e);return i},i.prototype.qqmapBounds2LocalBounds=function(t){return{min:{lat:t.lat.minY,lng:t.lng.minX},max:{lat:t.lat.maxY,lng:t.lng.maxX}}},i.prototype.hide=function(){this.visible=!1,this.viewChangeHandler(),this.scene.render()},i.prototype.show=function(){this.visible=!0,this.viewChangeHandler(),this.scene.render()},n.exports=i},{"../core/Animation.js":5,"../core/Util.js":7,"../core/geo.js":8,"./Dot.js":1,"./DotSpatialIndex.js":2,"./Rect.js":3}],5:[function(t,n,e){function i(t){if((t=t||{}).map){var n=t.map;this.fixFlag=!0,this.zoomChanging=!1,this.autoRender=!("autoRender"in t)||t.autoRender,this.transform=i.getTransformKey(),this.events={},this.setMap(n||null),this.setupStage(),this.style=this.parseStyle(t.style||this.style),this.opacity=t.opacity||1,t.data&&this.setData(t.data),this.mapStatus={zooming:!1,moving:!1,idle:!0}}}var s=t("./Scene.js"),a=(t("./map.js"),"c"+Math.random().toString(36).substr(2)),o=document.createElement("style");o.innerHTML=[".",a,"{position:absolute}"].join(""),document.head.appendChild(o),i.prototype=new qq.maps.Overlay,i.prototype.construct=i,i.prototype.init=function(){},i.prototype.viewChangeHandler=function(){},i.prototype.buildDataAndShapes=function(t){},i.prototype.parseStyle=function(t){return t},i.prototype.setData=function(t){this.autoRender||this.resize(),this.mapLoaded?this.buildDataAndShapes(t):qq.maps.event.addListenerOnce(this.map,"idle",function(){this.buildDataAndShapes(t)}.bind(this))},i.prototype.setupStage=function(){this.mapDiv=this.map.getContainer(),this.scene=new s,qq.maps.event.addListenerOnce(this.map,"idle",function(){this.mapLoaded=!0,this.map&&(this.createDoms(),this.autoRender&&this.resize(),this.addMapStatusListeners(),this.autoRender&&(this.addFixListeners(),this.animated?this.addAnimatedListeners():this.addStaticListeners()),this.scene.setContext(this.context),this.init())}.bind(this))},i.prototype.createDoms=function(){var t=this.container=document.createElement("div"),n=this.canvas=document.createElement("canvas");n.style.opacity=this.opacity,t.className=a+" emily",this.context=n.getContext("2d"),this.container.appendChild(n),this.getPanes().overlayLayer.appendChild(t)},i.prototype.addMapStatusListeners=function(){var t=this.mapStatus;qq.maps.event.addListener(this.map,"zoom_changed",function(){t.zooming=!0}.bind(this)),qq.maps.event.addListener(this.map,"center_changed",function(){t.moving=!0}.bind(this)),qq.maps.event.addListener(this.map,"idle",function(){t.zooming=!1,t.moving=!1,t.idle=!0}.bind(this))},i.prototype.addFixListeners=function(){qq.maps.event.addListener(this.map,"idle",function(){this.resize.bind(this)()}.bind(this))},i.prototype.addAnimatedListeners=function(){var t=this.mapStatus;qq.maps.event.addListener(this.map,"idle",function(){this.viewChangeHandler.bind(this)(),this.scene.play()}.bind(this)),qq.maps.event.addListener(this.map,"bounds_changed",function(){t.zooming?(this.reposition(),this.viewChangeHandler.bind(this)()):this.scene.stop()}.bind(this))},i.prototype.addStaticListeners=function(){var t=this.mapStatus;qq.maps.event.addListener(this.map,"idle",function(){Date.now();this.viewChangeHandler.bind(this)();Date.now();this.scene.render()}.bind(this)),qq.maps.event.addListener(this.map,"bounds_changed",function(){if(t.zooming){this.reposition();Date.now();this.viewChangeHandler.bind(this)();Date.now();this.scene.render()}}.bind(this))},i.prototype.reposition=function(){var t=this.map.getBounds(),n=new qq.maps.LatLng(t.getNorthEast().getLat(),t.getSouthWest().getLng()),e=this.getProjection().fromLatLngToDivPixel(n);this.container.style[this.transform]="translate("+Math.round(e.x)+"px,"+Math.round(e.y)+"px)"},i.prototype.resize=function(){var t=this.mapDiv.clientWidth,n=this.mapDiv.clientHeight;this.container.style.cssText="width:"+t+"px;height:"+n+"px;",this.canvas.width=t,this.canvas.height=n,this.reposition()},i.getTransformKey=function(){for(var t=document.createElement("div"),n=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],e=0;e<n.length;e++){var i=n[e];if(void 0!==t.style[i])return i}return n[0]},window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,n){window.setTimeout(t,1e3/60)}}()),n.exports=i},{"./Scene.js":6,"./map.js":9}],6:[function(t,n,e){function i(t){(t=t||{}).context&&this.setContext(t.context),this.playFlag=!1}i.prototype={constructor:i,setContext:function(t){this.context=t,this.updateSize()},render:function(){var t=this.shapes;this.clearCanvas();Date.now();for(var n,e=0;n=t[e++];)n.draw()},animate:function(){this.playFlag&&(this.render(),this.playFlag&&requestAnimationFrame(this.animate.bind(this)))},play:function(){this.playFlag||(this.playFlag=!0,this.animate())},stop:function(){this.playFlag=!1},clearCanvas:function(){this.context.clearRect(-200,-200,this.width+200,this.height+200)},updateSize:function(){var t=this.context.canvas;this.width=t.width,this.height=t.height},add:function(t){this.shapes.push(t)},get:function(t){return this.shapes[t]},setShapes:function(t){this.shapes=t}},n.exports=i},{}],7:[function(t,n,e){n.exports={extend:function(t,n,e){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);if(e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},any2rgba:function(t,n){t=t.toLowerCase();var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;return n=n||1,t&&e.test(t)?this.hex2rgb(t):t.indexOf("rgba")?t:t.indexOf("rgb")>-1?this.rgb2rgba(t,n):void 0},hex2rgb:function(t,n){if(4===(t=t.toLowerCase()).length){for(var e="#",i=1;i<4;i+=1)e+=t.slice(i,i+1).concat(t.slice(i,i+1));t=e}for(var s=[],i=1;i<7;i+=2)s.push(parseInt("0x"+t.slice(i,i+2)));return"rgba("+s.join(",")+","+(n||1)+")"},rgb2rgba:function(t,n){var e=t.replace("rgb(","rgba(").replace(")","").split(/\,|\)/);return 3==e.length&&e.push(n||"0.8"),e.join(",")+")"},buildColorCreator:function(t){var n=this.rgb2rgba(t).replace("rgb(","rgba(").split(",").splice(0,3).join(",")+",";return function(t){return n+t+")"}}}},{}],8:[function(t,n,e){n.exports={ll2mc:function(t){return{x:111319.49077777778*t.lng,y:Math.log(Math.tan(.008726646259971648*(90+t.lat)))/.017453292519943295*111319.49077777778}},mc2ll:function(t){var n=t.x/111319.49077777778;return{lat:Math.atan(Math.exp(t.y/111319.49077777778*.017453292519943295))/.008726646259971648-90,lng:n}},distance:function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},pointToLine:function(t,n,e){var i,s,a;if(i=this.distance(t,n),s=this.distance(t,e),(a=this.distance(n,e))+s==i)return 0;if(i<=1e-5)return s;if(a*a>=i*i+s*s)return s;if(s*s>=i*i+a*a)return a;var o=(i+s+a)/2;return 2*Math.sqrt(o*(o-i)*(o-s)*(o-a))/i},calculateArc:function(t,n,e,i){var s,a,o=Math.sqrt(Math.pow(t-e,2)+Math.pow(n-i,2));s=1.8*(n-i)+(t+e)/2,a=1.8*(e-t)+(n+i)/2;var r=Math.sqrt(Math.pow(o/2,2)+Math.pow(1.8*o,2)),l=Math.atan2(n-a,t-s),h=Math.atan2(i-a,e-s);l>h&&(h+=2*Math.PI);var u=function(){for(var o=Math.max(~~(Math.sqrt(r)/6),3),u=(h-l)/o,p=[{x:t,y:n}],d=1;d<o;d++)p.push(function(t,n,e,i){return{x:t+e*Math.sin(.5*Math.PI+i),y:n-e*Math.cos(.5*Math.PI+i)}}(s,a,r,l+d*u));return p.push({x:e,y:i}),p}();return{x:s,y:a,radius:r,startAngle:l,endAngle:h,l:o,segments:u}},getBounds:function(t,n){return{topLeft:{x:t.x-n/2,y:t.y-n/2},bottomRight:{x:t.x+n/2,y:t.y+n/2}}},inBounds:function(t,n){return t.x>n.topLeft.x&&t.x<n.bottomRight.x&&t.y>n.topLeft.y&&t.y<n.bottomRight.y},latlngInBounds:function(t,n){return t.lat<=n.max.lat&&t.lat>=n.min.lat&&t.lng<=n.max.lng&&t.lng>=n.min.lng},boundsInBounds:function(t,n){return t.max.lat<=n.max.lat&&t.max.lng<=n.max.lng&&t.min.lat>=n.min.lat&&t.min.lng>=n.min.lng},getUnionBounds:function(t,n){return this.boundsCrossBounds(t,n)?{max:{lat:Math.min(t.max.lat,n.max.lat),lng:Math.min(t.max.lng,n.max.lng)},min:{lat:Math.max(t.min.lat,n.min.lat),lng:Math.max(t.min.lng,n.min.lng)}}:null},boundsCrossBounds:function(t,n){return!(t.min.lat>n.max.lat||t.max.lat<n.min.lat||t.min.lng>n.max.lng||t.max.lng<n.min.lng)}}},{}],9:[function(t,n,e){n.exports.createMap=function(t){return new qq.maps.Map(t.container,t)}},{}],10:[function(t,n,e){var i=qq.maps.plugin=qq.maps.plugin||{};i.createMap=t("./core/map.js").createMap,i.Dots=t("./Dots")},{"./Dots":4,"./core/map.js":9}]},{},[10]);